<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{/SelfPro/layout}">
<div layout:fragment="content">


	<!-- 타일즈 쓸거면 여기부터하면 됨 -->
	<div class="container my-5">
		<div class="card shadow-sm p-4">
			<h3 class="text-center mb-4">今日の振り返り</h3>

			<form th:action="@{/todo/closing}" th:object="${todoForm}" method="post">
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<ul class="list-group mb-3">
					<!-- todos 리스트를 DTO 기준으로 반복 -->
					<li class="list-group-item" th:each="todo, stat : *{todos}">
						<div class="form-check">
							<!-- 체크박스: DTO.todos[인덱스].completed -->
							<input class="form-check-input" type="checkbox"
								th:field="*{todos[__${stat.index}__].completed}" th:id="'check-' + ${stat.index}" />

							<label class="form-check-label" th:for="'check-' + ${stat.index}"
								th:text="${todo.content}">할 일 내용</label>

							<!-- hidden id 바인딩 -->
							<input type="hidden" th:field="*{todos[__${stat.index}__].todoId}" />
						</div>
					</li>
				</ul>

				<div class="mb-3" th:if="${member.todayClosingDone == false}">
					<label for="hitogo" class="form-label">明日の自分にひとこと</label>
					<textarea class="form-control" th:field="*{hitogoto}" id="hitogo" placeholder="明日の自分にひとこと (最大 150字)"
						maxlength="150"></textarea>
				</div>
				<div class="mb-3" th:if="${member.todayClosingDone == true && #lists.size(todoForm.todos) > 0}">
					<div class="fs-1 p-3 mb-2 bg-success text-white text-center"> 今日の振り返りが完了しました!</div>
				</div>

				<div class="d-flex justify-content-end">
					<button type="submit"
						th:if="${#lists.size(todoForm.todos) > 0 && member.todayClosingDone == false }"
						class="btn btn-primary px-4">保存</button>
				</div>

				<div class="form-text mt-2">*　完了したタスクをチェックしてください。</div>
				<div class="form-text">* 「保存」 ボタンを押せるのは一日に一回のみです。</div>
			</form>

		</div>
	</div>



	<!-- 부트스트랩2 -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
		crossorigin="anonymous"></script>
</div>

</html>